<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of importCameras</title>
  <meta name="keywords" content="importCameras">
  <meta name="description" content="importCameras imports all the camera objects found in 'path'.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">src</a> &gt; importCameras.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>importCameras
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>importCameras imports all the camera objects found in 'path'.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [ cameras, status ] = importCameras( log, path ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">importCameras imports all the camera objects found in 'path'.
   
%-------------------------------------------------------------------------------------------------- 
   @desc Imports all the camera objects found in 'path', where a number of XML files of the
   form: 

   &lt;?xml version=&quot;1.0&quot; encoding=&quot;us-ascii&quot;?&gt;
   &lt;Cameras&gt;
   &lt;Camera&gt;
     &lt;name&gt; &lt;/name&gt;
     &lt;flen&gt; &lt;/flen&gt;
     &lt;imgh&gt; &lt;/imgh&gt;
     &lt;imgw&gt; &lt;/imgw&gt;
     &lt;senh&gt; &lt;/senh&gt;
     &lt;senw&gt; &lt;/senw&gt;
   &lt;/Camera&gt;
   ...
   &lt;/Cameras&gt; 

   has to be located.

%--------------------------------------------------------------------------------------------------  
   The inputs for this function are:
   
   - @iparam [graphics handle] log: handle of log console 
   - @iparam [String] path: Path to the directory containing all the XML archives. 
   
%--------------------------------------------------------------------------------------------------
   The outputs for this function are:
   
   - @oparam [struct] cameras: it is an array of structures with the following parameters:
       -&gt; [String] model: string containing camera name               
       -&gt; [float] focallen: focal length of the camera {mm}
       -&gt; [int] imwidth: width of the image {px}
       -&gt; [int] imheight: height of the image {px}
       -&gt; [float] sensorwidth: physical width of the sensor {mm}
       -&gt; [float] sensorheight: physical height of the sensor {mm}

   - @oparam [int] status: flag that indicates if everithing went fine (1) or not (-1)
   
%--------------------------------------------------------------------------------------------------
   ** @author Andrés Ferreiro González (@aferreiro)
   ** @company Galician Research And Development Center In Advanced Telecommunications (GRADIANT)
   ** @date 13/03/2017
   ** @version 1.2
%--------------------------------------------------------------------------------------------------
%%-------------------------------------------------------------------------------------------------</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="updateLog.html" class="code" title="function updateLog( log, strin, multiline )">updateLog</a>	updateLog updates the console log in the GridInspector Window.</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="gridInspector.html" class="code" title="function varargout = gridInspector(varargin)">gridInspector</a>	gridInspector MATLAB code for gridInspector.fig</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ cameras, status ] = importCameras( log, path )</a>
0002 <span class="comment">%importCameras imports all the camera objects found in 'path'.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%%--------------------------------------------------------------------------------------------------</span>
0005 <span class="comment">%   @desc Imports all the camera objects found in 'path', where a number of XML files of the</span>
0006 <span class="comment">%   form:</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%   &lt;?xml version=&quot;1.0&quot; encoding=&quot;us-ascii&quot;?&gt;</span>
0009 <span class="comment">%   &lt;Cameras&gt;</span>
0010 <span class="comment">%   &lt;Camera&gt;</span>
0011 <span class="comment">%     &lt;name&gt; &lt;/name&gt;</span>
0012 <span class="comment">%     &lt;flen&gt; &lt;/flen&gt;</span>
0013 <span class="comment">%     &lt;imgh&gt; &lt;/imgh&gt;</span>
0014 <span class="comment">%     &lt;imgw&gt; &lt;/imgw&gt;</span>
0015 <span class="comment">%     &lt;senh&gt; &lt;/senh&gt;</span>
0016 <span class="comment">%     &lt;senw&gt; &lt;/senw&gt;</span>
0017 <span class="comment">%   &lt;/Camera&gt;</span>
0018 <span class="comment">%   ...</span>
0019 <span class="comment">%   &lt;/Cameras&gt;</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%   has to be located.</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%%--------------------------------------------------------------------------------------------------</span>
0024 <span class="comment">%   The inputs for this function are:</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   - @iparam [graphics handle] log: handle of log console</span>
0027 <span class="comment">%   - @iparam [String] path: Path to the directory containing all the XML archives.</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%%--------------------------------------------------------------------------------------------------</span>
0030 <span class="comment">%   The outputs for this function are:</span>
0031 <span class="comment">%</span>
0032 <span class="comment">%   - @oparam [struct] cameras: it is an array of structures with the following parameters:</span>
0033 <span class="comment">%       -&gt; [String] model: string containing camera name</span>
0034 <span class="comment">%       -&gt; [float] focallen: focal length of the camera {mm}</span>
0035 <span class="comment">%       -&gt; [int] imwidth: width of the image {px}</span>
0036 <span class="comment">%       -&gt; [int] imheight: height of the image {px}</span>
0037 <span class="comment">%       -&gt; [float] sensorwidth: physical width of the sensor {mm}</span>
0038 <span class="comment">%       -&gt; [float] sensorheight: physical height of the sensor {mm}</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%   - @oparam [int] status: flag that indicates if everithing went fine (1) or not (-1)</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%%--------------------------------------------------------------------------------------------------</span>
0043 <span class="comment">%   ** @author Andrés Ferreiro González (@aferreiro)</span>
0044 <span class="comment">%   ** @company Galician Research And Development Center In Advanced Telecommunications (GRADIANT)</span>
0045 <span class="comment">%   ** @date 13/03/2017</span>
0046 <span class="comment">%   ** @version 1.2</span>
0047 <span class="comment">%%--------------------------------------------------------------------------------------------------</span>
0048 <span class="comment">%%%-------------------------------------------------------------------------------------------------</span>
0049 
0050 <span class="keyword">if</span> nargin &lt; 2
0051     
0052         error(<span class="string">'Not enough input arguments. Type &quot;help importCameras&quot; in the command prompt for more info about function usage.'</span>);
0053         
0054 <span class="keyword">elseif</span> nargin &gt; 2
0055     
0056         error(<span class="string">'Too many input arguments. Type &quot;help importCameras&quot; in the command prompt for more info about function usage.'</span>);
0057             
0058 <span class="keyword">end</span>
0059 
0060 fileList = dir(path);
0061 fileList = fileList(~[fileList.isdir]);      <span class="comment">% remove directories</span>
0062 [~ , sortorder] = sort([fileList.datenum]);
0063 fileList = fileList(sortorder);              <span class="comment">% list is now in ascending date order</span>
0064 
0065 numArch = numel(fileList);
0066 index = 1;
0067 noXML = 0;
0068 
0069 <a href="updateLog.html" class="code" title="function updateLog( log, strin, multiline )">updateLog</a>(log, <span class="string">'------EVENT------ Fetching cameras from disc at ''./Archives/'''</span>);
0070 
0071 <span class="keyword">if</span> numArch &gt; 1
0072 
0073     <span class="comment">% Loop trhought directory</span>
0074     <span class="keyword">for</span> ii = 1 : numArch
0075 
0076         <span class="keyword">try</span>
0077 
0078             tokens = strsplit(fileList(ii).name,<span class="string">'.'</span>);
0079             
0080             <span class="keyword">if</span> ~strcmp(tokens{end}, <span class="string">'xml'</span>) &amp;&amp; ~strcmp(tokens{end}, <span class="string">'XML'</span>) 
0081 
0082                 <a href="updateLog.html" class="code" title="function updateLog( log, strin, multiline )">updateLog</a>(log, sprintf(<span class="string">'The file %s is not a XML camera file'</span>, fileList(ii).name), 1);
0083                 noXML = noXML + 1;
0084                 <span class="keyword">continue</span>;
0085                 
0086             <span class="keyword">end</span>
0087             
0088             <span class="comment">% Open each archive</span>
0089             fileID = fopen(strcat(path,fileList(ii).name));
0090 
0091             <span class="comment">% Read lines</span>
0092             s = textscan(fileID, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, <span class="string">'\n'</span>); 
0093             fclose(fileID);
0094             cell = strcat(s{1});
0095 
0096             <span class="keyword">for</span> ll = 1 : length(cell)
0097 
0098                 line = cell{ll};
0099                 header = line(1:6);
0100 
0101                 <span class="keyword">switch</span>(header)
0102 
0103                     <span class="keyword">case</span> <span class="string">'&lt;name&gt;'</span>
0104 
0105                         ind = strfind(line, <span class="string">'&lt;/name&gt;'</span>);
0106 
0107                         cameras(index).model = line(7:ind-1);                   
0108 
0109                     <span class="keyword">case</span> <span class="string">'&lt;flen&gt;'</span>
0110 
0111                         ind = strfind(line, <span class="string">'&lt;/flen&gt;'</span>);
0112                         cameras(index).focallen = str2double(line(7:ind-1));
0113 
0114                     <span class="keyword">case</span> <span class="string">'&lt;imgh&gt;'</span>
0115 
0116                         ind = strfind(line, <span class="string">'&lt;/imgh&gt;'</span>);
0117                         cameras(index).imheight = str2double(line(7:ind-1));
0118 
0119                     <span class="keyword">case</span> <span class="string">'&lt;imgw&gt;'</span>
0120 
0121                         ind = strfind(line, <span class="string">'&lt;/imgw&gt;'</span>);
0122                         cameras(index).imwidth = str2double(line(7:ind-1));
0123 
0124                     <span class="keyword">case</span> <span class="string">'&lt;senh&gt;'</span>
0125 
0126                         ind = strfind(line, <span class="string">'&lt;/senh&gt;'</span>);
0127                         cameras(index).sensorheight = str2double(line(7:ind-1));
0128 
0129                     <span class="keyword">case</span> <span class="string">'&lt;senw&gt;'</span>
0130 
0131                         ind = strfind(line, <span class="string">'&lt;/senw&gt;'</span>);
0132                         cameras(index).sensorwidth = str2double(line(7:ind-1));
0133                         index = index + 1;
0134 
0135                     <span class="keyword">otherwise</span>
0136 
0137                         <span class="keyword">continue</span>;
0138 
0139                 <span class="keyword">end</span>
0140             <span class="keyword">end</span>            
0141             
0142             status = 1;
0143             
0144         <span class="keyword">catch</span> err
0145 
0146             status = -1;
0147             <a href="updateLog.html" class="code" title="function updateLog( log, strin, multiline )">updateLog</a>(log, sprintf(<span class="string">'------FATAL ERROR------ Something bad happened while reading %s'</span>, fileList(ii).name));
0148             <a href="updateLog.html" class="code" title="function updateLog( log, strin, multiline )">updateLog</a>(log, err.getReport());
0149             cameras = struct([]);
0150         <span class="keyword">end</span>
0151     <span class="keyword">end</span>
0152     
0153     
0154     <span class="keyword">if</span> status == 1
0155         
0156         <a href="updateLog.html" class="code" title="function updateLog( log, strin, multiline )">updateLog</a>(log, sprintf(<span class="string">'------EVENT------ Found %i cameras in %i archives'</span>, index, numArch - noXML));
0157     <span class="keyword">end</span>
0158     
0159 <span class="keyword">else</span>
0160    
0161     <a href="updateLog.html" class="code" title="function updateLog( log, strin, multiline )">updateLog</a>(log, <span class="string">'------FATAL ERROR------ There are no camera files in its folder (./Archives/)'</span>);
0162     cameras = struct([]);
0163     status = -1;
0164     
0165 <span class="keyword">end</span>
0166 
0167 <span class="keyword">end</span>
0168</pre></div>
<hr><address>Generated on Sat 25-Mar-2017 19:17:00 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>